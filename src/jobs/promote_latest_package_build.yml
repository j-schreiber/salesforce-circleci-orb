description: |
  This job promotes the the latest release candidate package version.

parameters:
  additionalSteps:
    default: []
    description: Provide optional steps you would like to run prior to the package promote
    type: steps
  devhubUsername:
    description: Username or alias of the DevHub
    type: string
  devhubInstanceUrl:
    description: Instance url of the DevHub, if you have a custom domain enabled.
    default: https://login.salesforce.com
    type: string
  devhubJwtKey:
    description: Name of the environment variable containing the base64 encoded private JWT key (server.key file) to authenticate to the DevHub.
    default: DEVHUB_JWT_KEY
    type: env_var_name
  devhubConsumerKey:
    description: Name of the environment variable containing the consumner key of the connected app on the DevHub. The CLI refers to this as "client id"
    default: DEVHUB_CONSUMER_KEY
    type: env_var_name
  packageVersionId:
    description: Environment variable with the package version id to promote. Required if promoteLatestBuild is false. Has no effect, if it's true.
    default: SUBSCRIBER_PACKAGE_VERSION_ID
    type: env_var_name
  promoteLatestBuild:
    description: Promotes the latest release candidate build of the package version. This queries the latest build from the DevHub.
    default: true
    type: boolean  
    
docker:
  - image: cimg/openjdk:17.0-node

steps:
  - checkout
  - steps: << parameters.additionalSteps >>
  - install
  - auth:
      username: << parameters.devhubUsername >>
      instanceUrl: << parameters.devhubInstanceUrl >>
      jwtKey: << parameters.devhubJwtKey >>
      consumerKey: << parameters.devhubConsumerKey >>
      setDefault: true,
  - package_promote
      ENV_VAR_PACKAGE_VERSION_ID: << parameters.packageVersionId >>
      PARAM_PROMOTE_LATEST_BUILD: << parameters.promoteLatestBuild >>
     
